<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Interactive model decision trees in Stata</title>
  <meta name="author" content="Jodie Burchell">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="Interactive model decision trees in Stata written September 22, 2015 in stata,programming tips,consulting">
  <meta name="keywords" content="stata, consulting, teaching, programming, data science" />

  <link rel="canonical" href="http://t-redactyl.github.io/blog/2015/09/interactive-model-decision-trees-in-stata.html">

  <link href="http://t-redactyl.github.io/favicon.png" rel="icon">

  <link href="http://t-redactyl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Standard error Full Atom Feed" />

  <link href="http://t-redactyl.github.io/theme/css/screen.css"  media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="http://t-redactyl.github.io/theme/css/tomorrow.css"  media="screen, projection" rel="stylesheet" type="text/css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

</head>
  <body>
    <a href="/" class="home-icon">
      <img src="http://t-redactyl.github.io/theme/images/home.png"/>
    </a>
<article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Interactive model decision trees in Stata</h1>
        <div class="meta">
          written <time datetime="2015-09-22T00:00:00+02:00">September 22, 2015</time>
          in <span class="categories">
            <a href="http://t-redactyl.github.io/tag/stata.html">stata</a>,            <a href="http://t-redactyl.github.io/tag/programming-tips.html">programming tips</a>,            <a href="http://t-redactyl.github.io/tag/consulting.html">consulting</a>          </span>
        </div>
        <p>When I was doing statistical consulting work in a university&#8217;s medical department, my clients often wanted me to teach them about the analyses I was doing for them, rather than just completing the work and handing it over. In addition, they were usually operating under limited budgets so wanted to do at least some of the work themselves to save&nbsp;money.</p>
<p>This was a bit of a problem when I needed to use fairly high-level statistics to model their data. In order to allow clients to do this sort of modelling work on their own, I designed a decision tree in <a href="http://www.stata.com">Stata</a> that helped them evaluate a series of models to reach the most suitable&nbsp;one.</p>
<h2>A brief&nbsp;background</h2>
<p>This all started when I was asked to do some analyses for a client who was doing a Ph.D. in immunology, who came to me with a pretty complicated dataset. She was trying to find out whether two groups of patients with hepatitis C had different levels of biomarkers. She had measured the biomarkers at different time points within the same person, and also had a bunch of different biomarker outcomes she wanted to evaluate. <a href="https://en.wikipedia.org/wiki/Multilevel_model">Multilevel models</a> (with random intercepts) were likely the most appropriate model for most of the outcomes, and the graphs demonstrated that time might have a <a href="https://en.wikipedia.org/wiki/Nonlinear_regression">curvilinear relationship</a> with some of the outcomes. These sorts of statistics were beyond the knowledge of my client, but she had so many outcomes she would need to do a lot of this model selection work&nbsp;herself. </p>
<p>In order to allow her to complete this work, I handed the data over to her with the decision-tree function described below (after doing the initial data cleaning, visualisations and testing for some of the&nbsp;assumptions).</p>
<h2>What does the function&nbsp;do?</h2>
<p>The function presents the user with several decision points in building a model, with clear instructions on how to evaluate the output they have been given. It allows them to input each decision on the Stata command line using simple y/n answers. Finally, it presents them with the final model and a brief explanation of what this&nbsp;is.</p>
<h2>A demonstration of the&nbsp;function</h2>
<p>There are several components to the&nbsp;function: </p>
<p><strong>The models that the user needs to evaluate.</strong> In the case of this decision-tree, one choice is between a random-intercepts multilevel model (with &#8220;subj&#8221; as the Level 2 variable) and a regression model with <a href="https://en.wikipedia.org/wiki/Robust_regression">robust standard errors</a> clustered by &#8220;subj&#8221;, and the other choice is between including a quadratic term for time or excluding it (don&#8217;t worry if you don&#8217;t fully understand what these are, the important part is understanding the function itself!). For example, this is one of the&nbsp;models:</p>
<div class="highlight"><pre><span></span><span class="err">xtmixed time i.group || subj: , var mle</span>
</pre></div>


<p><strong>The ability for the function to take user input using the &#8220;_request&#8221; command.</strong> This command assigns the user input to a local which the function can use. For&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="err">di &quot;Enter a value below in the &#39;command&#39; window (y/n)&quot; _request(_answer1)</span>
</pre></div>


<p><strong><a href="https://en.wikipedia.org/wiki/Conditional_(computer_programming)">Conditional statements</a> (if, else) that guide the client through the decision-making tree.</strong> These conditional statements evaluate the locals generated by the user input. For&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="err">if (&quot;&quot; == &quot;y&quot;) {               </span>
<span class="err">    xtmixed  time time_sq i.group || subj: , var mle</span>
<span class="err">}</span>
</pre></div>


<p>To demonstrate the function, I will use an example dataset (as my client&#8217;s data contains pretty sensitive medical information!). This is a dataset I sourced from <a href="http://www.ats.ucla.edu/stat/stata/library/gee.htm"><span class="caps">IDRE</span> at <span class="caps">UCLA</span></a>, which is an incredible statistics and statistical programming resource that has particularly good documentation for&nbsp;Stata.</p>
<p>This dataset contains depression scores for 61 participants in two different treatment groups (27 in the placebo and 34 in the estrogen treatment). Each participant was assessed at baseline (pre) and at 6 timepoints&nbsp;thereafter.</p>
<p>The depression scores are currently in a <strong>wide</strong> format, with a variable for each timepoint. As we are doing regression analyses, we&#8217;ll need all the depression scores in a single variable, therefore we&#8217;ll convert the data to a <strong>long</strong>&nbsp;format.</p>
<div class="highlight"><pre><span></span>  <span class="n">use</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">ats</span><span class="p">.</span><span class="n">ucla</span><span class="p">.</span><span class="n">edu</span><span class="o">/</span><span class="n">stat</span><span class="o">/</span><span class="n">stata</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">depress</span><span class="p">,</span> <span class="n">clear</span>
  <span class="n">reshape</span> <span class="n">long</span> <span class="n">dep</span><span class="p">,</span> <span class="n">i</span><span class="p">(</span><span class="n">subj</span><span class="p">)</span>
  <span class="p">(</span><span class="n">note</span><span class="p">:</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">)</span>

  <span class="k">Data</span>                               <span class="n">wide</span>   <span class="o">-&gt;</span>   <span class="n">long</span>
  <span class="c1">-----------------------------------------------------------------------------</span>
  <span class="nb">Number</span> <span class="k">of</span> <span class="n">obs</span><span class="p">.</span>                       <span class="mi">61</span>   <span class="o">-&gt;</span>     <span class="mi">366</span>
  <span class="nb">Number</span> <span class="k">of</span> <span class="n">variables</span>                   <span class="mi">9</span>   <span class="o">-&gt;</span>       <span class="mi">5</span>
  <span class="n">j</span> <span class="k">variable</span> <span class="p">(</span><span class="mi">6</span> <span class="k">values</span><span class="p">)</span>                     <span class="o">-&gt;</span>   <span class="n">_j</span>
  <span class="n">xij</span> <span class="n">variables</span><span class="p">:</span>
                       <span class="n">dep1</span> <span class="n">dep2</span> <span class="p">...</span> <span class="n">dep6</span>   <span class="o">-&gt;</span>   <span class="n">dep</span>
  <span class="c1">-----------------------------------------------------------------------------</span>

  <span class="k">rename</span> <span class="n">_j</span> <span class="n">time</span>
  <span class="k">drop</span> <span class="n">pre</span>
</pre></div>


<p>Let&#8217;s now visualise the data to get an idea of how the two groups&#8217; scores behave over&nbsp;time:</p>
<div class="highlight"><pre><span></span><span class="err">  twoway /// </span>
<span class="err">    (lowess dep time if group == 0, lcolor(&quot;169 204 6&quot;) lwidth(thick)) /// </span>
<span class="err">    (lowess dep time if group == 1, lcolor(&quot;84 102 3&quot;) lwidth(thick)), /// </span>
<span class="err">    title(&quot;Depression Scores Over Time&quot;) /// </span>
<span class="err">    ytitle(&quot;Depression scores&quot;, size(medsmall)) ///</span>
<span class="err">    xtitle(&quot;Time&quot;) /// </span>
<span class="err">    graphregion(color(white)) /// </span>
<span class="err">    legend(cols(2) ///</span>
<span class="err">        label(1 &quot;Placebo&quot;) /// </span>
<span class="err">        label(2 &quot;Estrogen&quot;))</span>
</pre></div>


<p><img alt="plot of lowess_graph_stata" src="/figure/lowess_graph_stata.png"></p>
<p>The relationship between time and depression seems linear for both groups, but I will keep the quadratic decision-making step in the function for now. Let&#8217;s generate the quadratic term for&nbsp;time:</p>
<div class="highlight"><pre><span></span><span class="err">  gen time_sq = time ^ 2</span>
</pre></div>


<p>Now we run the function&nbsp;below:</p>
<div class="highlight"><pre><span></span><span class="n">capture</span> <span class="n">program</span> <span class="k">drop</span> <span class="n">model_decision</span>
    <span class="n">program</span> <span class="n">model_decision</span>
    <span class="n">args</span> <span class="n">outcome</span>

    <span class="n">xtmixed</span> <span class="o">`</span><span class="n">outcome</span><span class="s1">&#39; time i.group || subj: , var mle</span>

<span class="s1">    di _newline(1)</span>
<span class="s1">    di &quot;Step 1: Evaluate initial model.&quot; _newline(2) ///</span>
<span class="s1">        &quot;Look at the bottom of the output where it reads: &#39;</span><span class="n">LR</span> <span class="n">test</span> <span class="n">vs</span><span class="p">.</span> <span class="n">linear</span> <span class="n">regression</span><span class="p">...</span><span class="n">Prob</span> <span class="o">&gt;=</span> <span class="n">chibar2</span> <span class="o">=</span><span class="s1">&#39;&quot; _newline(1) ///</span>
<span class="s1">        &quot;Does &#39;</span><span class="n">Prob</span> <span class="o">&gt;=</span> <span class="n">chibar2</span><span class="s1">&#39; have a value of &lt; .05? &quot; _newline(2) /// </span>
<span class="s1">        &quot;Enter a value below in the &#39;</span><span class="n">command</span><span class="s1">&#39; window (y/n)&quot; _request(_answer1)</span>

<span class="s1">    if (&quot;`answer1&#39;</span><span class="ss">&quot; == &quot;</span><span class="n">y</span><span class="ss">&quot;) {</span>

<span class="ss">        xtmixed `outcome&#39; time time_sq i.group || subj: , var mle</span>

<span class="ss">        di _newline(2) ///</span>
<span class="ss">            &quot;</span><span class="n">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Now</span> <span class="n">look</span> <span class="k">at</span> <span class="n">the</span> <span class="k">row</span> <span class="k">of</span> <span class="n">the</span> <span class="k">first</span> <span class="k">table</span> <span class="n">labelled</span> <span class="s1">&#39;time_sq&#39;</span><span class="p">.</span><span class="ss">&quot; _newline(1) ///</span>
<span class="ss">            &quot;</span><span class="k">Is</span> <span class="n">this</span> <span class="k">variable</span> <span class="n">significant</span><span class="o">?</span> <span class="ss">&quot;  _newline(2) ///</span>
<span class="ss">            &quot;</span><span class="n">Enter</span> <span class="n">a</span> <span class="n">value</span> <span class="n">below</span> <span class="k">in</span> <span class="n">the</span> <span class="s1">&#39;command&#39;</span> <span class="n">window</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="ss">&quot; _request(_answer2)</span>
<span class="ss">            di _newline(2)</span>

<span class="ss">        }</span>

<span class="ss">    else if (&quot;</span><span class="o">`</span><span class="n">answer1</span><span class="s1">&#39;&quot; == &quot;n&quot;) {</span>

<span class="s1">        regress `outcome&#39;</span> <span class="n">time</span> <span class="n">time_sq</span> <span class="n">i</span><span class="p">.</span><span class="k">group</span><span class="p">,</span> <span class="n">vce</span><span class="p">(</span><span class="k">cluster</span> <span class="n">id</span><span class="p">)</span>

        <span class="n">di</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">///</span>   
            <span class="ss">&quot;Step 2: Now look at the row of the table labelled &#39;time_sq&#39;.&quot;</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">///</span>
            <span class="ss">&quot;Is this variable significant? &quot;</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">///</span>
            <span class="ss">&quot;Enter a value below in the &#39;command&#39; window (y/n)&quot;</span> <span class="n">_request</span><span class="p">(</span><span class="n">_answer3</span><span class="p">)</span>
            <span class="n">di</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="err">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="ss">&quot;`answer2&#39;&quot;</span> <span class="o">==</span> <span class="ss">&quot;y&quot;</span><span class="p">)</span> <span class="err">{</span>
        <span class="n">di</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">///</span>
        <span class="ss">&quot;The final model for `outcome&#39; is below. &quot;</span> <span class="o">///</span>
        <span class="ss">&quot;This is a random-intercepts multilevel model with a quadratic term.&quot;</span>
        <span class="n">di</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">xtmixed</span> <span class="o">`</span><span class="n">outcome</span><span class="s1">&#39; time time_sq i.group || subj: , var mle</span>

<span class="s1">        }</span>

<span class="s1">    else if (&quot;`answer2&#39;</span><span class="ss">&quot; == &quot;</span><span class="n">n</span><span class="ss">&quot;) {</span>
<span class="ss">        di _newline(2) ///</span>
<span class="ss">        &quot;</span><span class="n">The</span> <span class="k">final</span> <span class="n">model</span> <span class="k">for</span> <span class="o">`</span><span class="n">outcome</span><span class="s1">&#39; is below. &quot; ///</span>
<span class="s1">        &quot;This is a random-intercepts multilevel model.&quot;</span>
<span class="s1">        di _newline(1)</span>

<span class="s1">        xtmixed `outcome&#39;</span> <span class="n">time</span> <span class="n">i</span><span class="p">.</span><span class="k">group</span> <span class="o">||</span> <span class="n">subj</span><span class="p">:</span> <span class="p">,</span> <span class="n">var</span> <span class="n">mle</span>

        <span class="err">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="ss">&quot;`answer3&#39;&quot;</span> <span class="o">==</span> <span class="ss">&quot;y&quot;</span><span class="p">)</span> <span class="err">{</span>
        <span class="n">di</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">///</span>
        <span class="ss">&quot;The final model for `outcome&#39; is below. &quot;</span> <span class="o">///</span>
        <span class="ss">&quot;This is a linear regression with a quadratic term which has robust standard errors clustered by ID.&quot;</span>
        <span class="n">di</span> <span class="n">_newline</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">regress</span> <span class="o">`</span><span class="n">outcome</span><span class="s1">&#39; time time_sq i.group, vce(cluster id)</span>

<span class="s1">        }</span>

<span class="s1">    else if (&quot;`answer3&#39;</span><span class="ss">&quot; == &quot;</span><span class="n">n</span><span class="ss">&quot;) {</span>
<span class="ss">        di _newline(2) ///</span>
<span class="ss">        &quot;</span><span class="n">The</span> <span class="k">final</span> <span class="n">model</span> <span class="k">for</span> <span class="o">`</span><span class="n">outcome</span><span class="s1">&#39; is below. &quot; ///</span>
<span class="s1">        &quot;This is a linear regression which has robust standard errors clustered by ID.&quot;</span>
<span class="s1">        di _newline(1)</span>

<span class="s1">        regress `outcome&#39;</span> <span class="n">time</span> <span class="n">time_sq</span> <span class="n">i</span><span class="p">.</span><span class="k">group</span><span class="p">,</span> <span class="n">vce</span><span class="p">(</span><span class="k">cluster</span> <span class="n">id</span><span class="p">)</span>

        <span class="err">}</span>
<span class="k">end</span>
</pre></div>


<p>Once you have everything set up as above, it is simple! We just get the user to call the&nbsp;function:</p>
<div class="highlight"><pre><span></span><span class="err">model_decision dep</span>
</pre></div>


<p>The output that the user sees is shown below, but I recommend you run the function yourself within Stata to see how the user will actually interact with the&nbsp;program.</p>
<div class="highlight"><pre><span></span>  <span class="n">Performing</span> <span class="n">EM</span> <span class="n">optimization</span><span class="p">:</span>

  <span class="n">Performing</span> <span class="n">gradient</span><span class="o">-</span><span class="n">based</span> <span class="n">optimization</span><span class="p">:</span>

  <span class="n">Iteration</span> <span class="mi">0</span><span class="p">:</span>   <span class="n">log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">98669</span>  
  <span class="n">Iteration</span> <span class="mi">1</span><span class="p">:</span>   <span class="n">log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">98669</span>

  <span class="n">Computing</span> <span class="n">standard</span> <span class="n">errors</span><span class="p">:</span>

  <span class="n">Mixed</span><span class="o">-</span><span class="n">effects</span> <span class="n">ML</span> <span class="n">regression</span>                     <span class="nb">Number</span> <span class="k">of</span> <span class="n">obs</span>      <span class="o">=</span>       <span class="mi">295</span>
  <span class="k">Group</span> <span class="k">variable</span><span class="p">:</span> <span class="n">subj</span>                            <span class="nb">Number</span> <span class="k">of</span> <span class="n">groups</span>   <span class="o">=</span>        <span class="mi">61</span>

                                                  <span class="n">Obs</span> <span class="n">per</span> <span class="k">group</span><span class="p">:</span> <span class="k">min</span> <span class="o">=</span>         <span class="mi">1</span>
                                                                 <span class="k">avg</span> <span class="o">=</span>       <span class="mi">4</span><span class="p">.</span><span class="mi">8</span>
                                                                 <span class="k">max</span> <span class="o">=</span>         <span class="mi">6</span>


                                                  <span class="n">Wald</span> <span class="n">chi2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>       <span class="o">=</span>    <span class="mi">122</span><span class="p">.</span><span class="mi">49</span>
  <span class="n">Log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">98669</span>                     <span class="n">Prob</span> <span class="o">&gt;</span> <span class="n">chi2</span>        <span class="o">=</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">0000</span>

  <span class="c1">------------------------------------------------------------------------------</span>
           <span class="n">dep</span> <span class="o">|</span>      <span class="n">Coef</span><span class="p">.</span>   <span class="n">Std</span><span class="p">.</span> <span class="n">Err</span><span class="p">.</span>      <span class="n">z</span>    <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span>     <span class="p">[</span><span class="mi">95</span><span class="o">%</span> <span class="n">Conf</span><span class="p">.</span> <span class="nb">Interval</span><span class="p">]</span>
  <span class="c1">-------------+----------------------------------------------------------------</span>
          <span class="n">time</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">22265</span>   <span class="p">.</span><span class="mi">1169081</span>   <span class="o">-</span><span class="mi">10</span><span class="p">.</span><span class="mi">46</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">000</span>    <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">451785</span>    <span class="o">-</span><span class="p">.</span><span class="mi">993514</span>
               <span class="o">|</span>
         <span class="k">group</span> <span class="o">|</span>
     <span class="n">estrogen</span>  <span class="o">|</span>  <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">780498</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">174419</span>    <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">22</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">001</span>    <span class="o">-</span><span class="mi">6</span><span class="p">.</span><span class="mi">082316</span>   <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">478679</span>
         <span class="n">_cons</span> <span class="o">|</span>   <span class="mi">17</span><span class="p">.</span><span class="mi">97587</span>   <span class="p">.</span><span class="mi">9454841</span>    <span class="mi">19</span><span class="p">.</span><span class="mi">01</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">000</span>     <span class="mi">16</span><span class="p">.</span><span class="mi">12276</span>    <span class="mi">19</span><span class="p">.</span><span class="mi">82899</span>
  <span class="c1">------------------------------------------------------------------------------</span>

  <span class="c1">------------------------------------------------------------------------------</span>
    <span class="n">Random</span><span class="o">-</span><span class="n">effects</span> <span class="k">Parameters</span>  <span class="o">|</span>   <span class="n">Estimate</span>   <span class="n">Std</span><span class="p">.</span> <span class="n">Err</span><span class="p">.</span>     <span class="p">[</span><span class="mi">95</span><span class="o">%</span> <span class="n">Conf</span><span class="p">.</span> <span class="nb">Interval</span><span class="p">]</span>
  <span class="c1">-----------------------------+------------------------------------------------</span>
  <span class="n">subj</span><span class="p">:</span> <span class="k">Identity</span>               <span class="o">|</span>
                    <span class="n">var</span><span class="p">(</span><span class="n">_cons</span><span class="p">)</span> <span class="o">|</span>   <span class="mi">17</span><span class="p">.</span><span class="mi">42846</span>   <span class="mi">3</span><span class="p">.</span><span class="mi">696099</span>      <span class="mi">11</span><span class="p">.</span><span class="mi">50118</span>    <span class="mi">26</span><span class="p">.</span><span class="mi">41044</span>
  <span class="c1">-----------------------------+------------------------------------------------</span>
                 <span class="n">var</span><span class="p">(</span><span class="n">Residual</span><span class="p">)</span> <span class="o">|</span>   <span class="mi">11</span><span class="p">.</span><span class="mi">19347</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">031967</span>      <span class="mi">9</span><span class="p">.</span><span class="mi">343066</span>    <span class="mi">13</span><span class="p">.</span><span class="mi">41035</span>
  <span class="c1">------------------------------------------------------------------------------</span>
  <span class="n">LR</span> <span class="n">test</span> <span class="n">vs</span><span class="p">.</span> <span class="n">linear</span> <span class="n">regression</span><span class="p">:</span> <span class="n">chibar2</span><span class="p">(</span><span class="mi">01</span><span class="p">)</span> <span class="o">=</span>   <span class="mi">152</span><span class="p">.</span><span class="mi">15</span> <span class="n">Prob</span> <span class="o">&gt;=</span> <span class="n">chibar2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0000</span>


  <span class="n">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Evaluate</span> <span class="n">initial</span> <span class="n">model</span><span class="p">.</span>

  <span class="n">Look</span> <span class="k">at</span> <span class="n">the</span> <span class="n">bottom</span> <span class="k">of</span> <span class="n">the</span> <span class="k">output</span> <span class="k">where</span> <span class="n">it</span> <span class="k">reads</span><span class="p">:</span> <span class="s1">&#39;LR test vs. linear regression...Prob &gt;= chibar2 =&#39;</span>
  <span class="n">Does</span> <span class="s1">&#39;Prob &gt;= chibar2&#39;</span> <span class="n">have</span> <span class="n">a</span> <span class="n">value</span> <span class="k">of</span> <span class="o">&lt;</span> <span class="p">.</span><span class="mi">05</span><span class="o">?</span>

  <span class="n">Enter</span> <span class="n">a</span> <span class="n">value</span> <span class="n">below</span> <span class="k">in</span> <span class="n">the</span> <span class="s1">&#39;command&#39;</span> <span class="n">window</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">n</span><span class="p">).</span> <span class="n">y</span>

  <span class="n">Performing</span> <span class="n">EM</span> <span class="n">optimization</span><span class="p">:</span>

  <span class="n">Performing</span> <span class="n">gradient</span><span class="o">-</span><span class="n">based</span> <span class="n">optimization</span><span class="p">:</span>

  <span class="n">Iteration</span> <span class="mi">0</span><span class="p">:</span>   <span class="n">log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">40586</span>  
  <span class="n">Iteration</span> <span class="mi">1</span><span class="p">:</span>   <span class="n">log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">40586</span>

  <span class="n">Computing</span> <span class="n">standard</span> <span class="n">errors</span><span class="p">:</span>

  <span class="n">Mixed</span><span class="o">-</span><span class="n">effects</span> <span class="n">ML</span> <span class="n">regression</span>                     <span class="nb">Number</span> <span class="k">of</span> <span class="n">obs</span>      <span class="o">=</span>       <span class="mi">295</span>
  <span class="k">Group</span> <span class="k">variable</span><span class="p">:</span> <span class="n">subj</span>                            <span class="nb">Number</span> <span class="k">of</span> <span class="n">groups</span>   <span class="o">=</span>        <span class="mi">61</span>

                                                  <span class="n">Obs</span> <span class="n">per</span> <span class="k">group</span><span class="p">:</span> <span class="k">min</span> <span class="o">=</span>         <span class="mi">1</span>
                                                                 <span class="k">avg</span> <span class="o">=</span>       <span class="mi">4</span><span class="p">.</span><span class="mi">8</span>
                                                                 <span class="k">max</span> <span class="o">=</span>         <span class="mi">6</span>


                                                  <span class="n">Wald</span> <span class="n">chi2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>       <span class="o">=</span>    <span class="mi">124</span><span class="p">.</span><span class="mi">14</span>
  <span class="n">Log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">40586</span>                     <span class="n">Prob</span> <span class="o">&gt;</span> <span class="n">chi2</span>        <span class="o">=</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">0000</span>

  <span class="c1">------------------------------------------------------------------------------</span>
           <span class="n">dep</span> <span class="o">|</span>      <span class="n">Coef</span><span class="p">.</span>   <span class="n">Std</span><span class="p">.</span> <span class="n">Err</span><span class="p">.</span>      <span class="n">z</span>    <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span>     <span class="p">[</span><span class="mi">95</span><span class="o">%</span> <span class="n">Conf</span><span class="p">.</span> <span class="nb">Interval</span><span class="p">]</span>
  <span class="c1">-------------+----------------------------------------------------------------</span>
          <span class="n">time</span> <span class="o">|</span>  <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">814816</span>   <span class="p">.</span><span class="mi">5610959</span>    <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">23</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">001</span>    <span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">914544</span>   <span class="o">-</span><span class="p">.</span><span class="mi">7150883</span>
       <span class="n">time_sq</span> <span class="o">|</span>   <span class="p">.</span><span class="mi">0852873</span>   <span class="p">.</span><span class="mi">0790511</span>     <span class="mi">1</span><span class="p">.</span><span class="mi">08</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">281</span>      <span class="o">-</span><span class="p">.</span><span class="mi">06965</span>    <span class="p">.</span><span class="mi">2402246</span>
               <span class="o">|</span>
         <span class="k">group</span> <span class="o">|</span>
     <span class="n">estrogen</span>  <span class="o">|</span>  <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">747568</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">171837</span>    <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">20</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">001</span>    <span class="o">-</span><span class="mi">6</span><span class="p">.</span><span class="mi">044326</span>   <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">450811</span>
         <span class="n">_cons</span> <span class="o">|</span>   <span class="mi">18</span><span class="p">.</span><span class="mi">69979</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">157469</span>    <span class="mi">16</span><span class="p">.</span><span class="mi">16</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">000</span>     <span class="mi">16</span><span class="p">.</span><span class="mi">43119</span>    <span class="mi">20</span><span class="p">.</span><span class="mi">96839</span>
  <span class="c1">------------------------------------------------------------------------------</span>

  <span class="c1">------------------------------------------------------------------------------</span>
    <span class="n">Random</span><span class="o">-</span><span class="n">effects</span> <span class="k">Parameters</span>  <span class="o">|</span>   <span class="n">Estimate</span>   <span class="n">Std</span><span class="p">.</span> <span class="n">Err</span><span class="p">.</span>     <span class="p">[</span><span class="mi">95</span><span class="o">%</span> <span class="n">Conf</span><span class="p">.</span> <span class="nb">Interval</span><span class="p">]</span>
  <span class="c1">-----------------------------+------------------------------------------------</span>
  <span class="n">subj</span><span class="p">:</span> <span class="k">Identity</span>               <span class="o">|</span>
                    <span class="n">var</span><span class="p">(</span><span class="n">_cons</span><span class="p">)</span> <span class="o">|</span>   <span class="mi">17</span><span class="p">.</span><span class="mi">33573</span>   <span class="mi">3</span><span class="p">.</span><span class="mi">674356</span>      <span class="mi">11</span><span class="p">.</span><span class="mi">44268</span>    <span class="mi">26</span><span class="p">.</span><span class="mi">26375</span>
  <span class="c1">-----------------------------+------------------------------------------------</span>
                 <span class="n">var</span><span class="p">(</span><span class="n">Residual</span><span class="p">)</span> <span class="o">|</span>   <span class="mi">11</span><span class="p">.</span><span class="mi">15279</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">028017</span>      <span class="mi">9</span><span class="p">.</span><span class="mi">309431</span>    <span class="mi">13</span><span class="p">.</span><span class="mi">36114</span>
  <span class="c1">------------------------------------------------------------------------------</span>
  <span class="n">LR</span> <span class="n">test</span> <span class="n">vs</span><span class="p">.</span> <span class="n">linear</span> <span class="n">regression</span><span class="p">:</span> <span class="n">chibar2</span><span class="p">(</span><span class="mi">01</span><span class="p">)</span> <span class="o">=</span>   <span class="mi">152</span><span class="p">.</span><span class="mi">44</span> <span class="n">Prob</span> <span class="o">&gt;=</span> <span class="n">chibar2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0000</span>


  <span class="n">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Now</span> <span class="n">look</span> <span class="k">at</span> <span class="n">the</span> <span class="k">row</span> <span class="k">of</span> <span class="n">the</span> <span class="k">first</span> <span class="k">table</span> <span class="n">labelled</span> <span class="s1">&#39;time_sq&#39;</span><span class="p">.</span>
  <span class="k">Is</span> <span class="n">this</span> <span class="k">variable</span> <span class="n">significant</span><span class="o">?</span>

  <span class="n">Enter</span> <span class="n">a</span> <span class="n">value</span> <span class="n">below</span> <span class="k">in</span> <span class="n">the</span> <span class="s1">&#39;command&#39;</span> <span class="n">window</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">n</span><span class="p">).</span> <span class="n">n</span>

  <span class="n">The</span> <span class="k">final</span> <span class="n">model</span> <span class="k">for</span> <span class="n">dep</span> <span class="k">is</span> <span class="n">below</span><span class="p">.</span> <span class="n">This</span> <span class="k">is</span> <span class="n">a</span> <span class="n">random</span><span class="o">-</span><span class="n">intercepts</span> <span class="n">multilevel</span> <span class="n">model</span><span class="p">.</span>

  <span class="n">Performing</span> <span class="n">EM</span> <span class="n">optimization</span><span class="p">:</span>

  <span class="n">Performing</span> <span class="n">gradient</span><span class="o">-</span><span class="n">based</span> <span class="n">optimization</span><span class="p">:</span>

  <span class="n">Iteration</span> <span class="mi">0</span><span class="p">:</span>   <span class="n">log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">98669</span>  
  <span class="n">Iteration</span> <span class="mi">1</span><span class="p">:</span>   <span class="n">log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">98669</span>

  <span class="n">Computing</span> <span class="n">standard</span> <span class="n">errors</span><span class="p">:</span>

  <span class="n">Mixed</span><span class="o">-</span><span class="n">effects</span> <span class="n">ML</span> <span class="n">regression</span>                     <span class="nb">Number</span> <span class="k">of</span> <span class="n">obs</span>      <span class="o">=</span>       <span class="mi">295</span>
  <span class="k">Group</span> <span class="k">variable</span><span class="p">:</span> <span class="n">subj</span>                            <span class="nb">Number</span> <span class="k">of</span> <span class="n">groups</span>   <span class="o">=</span>        <span class="mi">61</span>

                                                  <span class="n">Obs</span> <span class="n">per</span> <span class="k">group</span><span class="p">:</span> <span class="k">min</span> <span class="o">=</span>         <span class="mi">1</span>
                                                                 <span class="k">avg</span> <span class="o">=</span>       <span class="mi">4</span><span class="p">.</span><span class="mi">8</span>
                                                                 <span class="k">max</span> <span class="o">=</span>         <span class="mi">6</span>


                                                  <span class="n">Wald</span> <span class="n">chi2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>       <span class="o">=</span>    <span class="mi">122</span><span class="p">.</span><span class="mi">49</span>
  <span class="n">Log</span> <span class="n">likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mi">836</span><span class="p">.</span><span class="mi">98669</span>                     <span class="n">Prob</span> <span class="o">&gt;</span> <span class="n">chi2</span>        <span class="o">=</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">0000</span>

  <span class="c1">------------------------------------------------------------------------------</span>
           <span class="n">dep</span> <span class="o">|</span>      <span class="n">Coef</span><span class="p">.</span>   <span class="n">Std</span><span class="p">.</span> <span class="n">Err</span><span class="p">.</span>      <span class="n">z</span>    <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span>     <span class="p">[</span><span class="mi">95</span><span class="o">%</span> <span class="n">Conf</span><span class="p">.</span> <span class="nb">Interval</span><span class="p">]</span>
  <span class="c1">-------------+----------------------------------------------------------------</span>
          <span class="n">time</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">22265</span>   <span class="p">.</span><span class="mi">1169081</span>   <span class="o">-</span><span class="mi">10</span><span class="p">.</span><span class="mi">46</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">000</span>    <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">451785</span>    <span class="o">-</span><span class="p">.</span><span class="mi">993514</span>
               <span class="o">|</span>
         <span class="k">group</span> <span class="o">|</span>
     <span class="n">estrogen</span>  <span class="o">|</span>  <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">780498</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">174419</span>    <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">22</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">001</span>    <span class="o">-</span><span class="mi">6</span><span class="p">.</span><span class="mi">082316</span>   <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">478679</span>
         <span class="n">_cons</span> <span class="o">|</span>   <span class="mi">17</span><span class="p">.</span><span class="mi">97587</span>   <span class="p">.</span><span class="mi">9454841</span>    <span class="mi">19</span><span class="p">.</span><span class="mi">01</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">000</span>     <span class="mi">16</span><span class="p">.</span><span class="mi">12276</span>    <span class="mi">19</span><span class="p">.</span><span class="mi">82899</span>
  <span class="c1">------------------------------------------------------------------------------</span>

  <span class="c1">------------------------------------------------------------------------------</span>
    <span class="n">Random</span><span class="o">-</span><span class="n">effects</span> <span class="k">Parameters</span>  <span class="o">|</span>   <span class="n">Estimate</span>   <span class="n">Std</span><span class="p">.</span> <span class="n">Err</span><span class="p">.</span>     <span class="p">[</span><span class="mi">95</span><span class="o">%</span> <span class="n">Conf</span><span class="p">.</span> <span class="nb">Interval</span><span class="p">]</span>
  <span class="c1">-----------------------------+------------------------------------------------</span>
  <span class="n">subj</span><span class="p">:</span> <span class="k">Identity</span>               <span class="o">|</span>
                    <span class="n">var</span><span class="p">(</span><span class="n">_cons</span><span class="p">)</span> <span class="o">|</span>   <span class="mi">17</span><span class="p">.</span><span class="mi">42846</span>   <span class="mi">3</span><span class="p">.</span><span class="mi">696099</span>      <span class="mi">11</span><span class="p">.</span><span class="mi">50118</span>    <span class="mi">26</span><span class="p">.</span><span class="mi">41044</span>
  <span class="c1">-----------------------------+------------------------------------------------</span>
                 <span class="n">var</span><span class="p">(</span><span class="n">Residual</span><span class="p">)</span> <span class="o">|</span>   <span class="mi">11</span><span class="p">.</span><span class="mi">19347</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">031967</span>      <span class="mi">9</span><span class="p">.</span><span class="mi">343066</span>    <span class="mi">13</span><span class="p">.</span><span class="mi">41035</span>
  <span class="c1">------------------------------------------------------------------------------</span>
  <span class="n">LR</span> <span class="n">test</span> <span class="n">vs</span><span class="p">.</span> <span class="n">linear</span> <span class="n">regression</span><span class="p">:</span> <span class="n">chibar2</span><span class="p">(</span><span class="mi">01</span><span class="p">)</span> <span class="o">=</span>   <span class="mi">152</span><span class="p">.</span><span class="mi">15</span> <span class="n">Prob</span> <span class="o">&gt;=</span> <span class="n">chibar2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0000</span>
</pre></div>


<h2>The take away&nbsp;message</h2>
<p>I hope this program has given you some ideas for teaching clients or students about model building. The function can be easily adapted to any decision-making process where the user can easily choose between models on the basis of the output. It is also obviously not limited to two decision points - you can have as many as you can reasonably keep track of (although it will get confusing pretty fast as the number of decision points increases&#8230;). The code for this post is located in this <a href="https://gist.github.com/t-redactyl/2e31fc12a66d4a5e9f8b">gist on my Github page</a>.</p>
<p>This post was written in Stata using <a href="http://www.haghish.com/statistics/stata-blog/reproducible-research/dynamic_documents/markdown.php#fn3">MarkDoc</a>, which was developed by the talented <span class="caps">E. F.</span>&nbsp;Haghish.</p>
        <hr class="divider-short"/>
        <!-- Disqus goes here -->
        <!-- <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite">Disqus goes here</div>
        </section>
        -->
      </div>
    </div>
  </div>
</article>
    <footer id="footer" class="her-row">
      <div class="container">
        <div class="row">
          <div class="col-md-1">
            <a href="/"><h4>Home</h4></a>
          </div>

          <div class="col-md-2">
            <div class="social-icon-list">
              <a href="https://twitter.com/t_redactyl"><img src="http://t-redactyl.github.io/theme/images/glyphicons_social_31_twitter.png"/></a>

              <a href="https://github.com/t-redactyl"><img src="http://t-redactyl.github.io/theme/images/glyphicons_social_21_github.png"/></a>


            </div>
          </div>
          <div class="pull-right">
            <h4>Powered by <a href="http://blog.getpelican.com/">Pelican</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>. Title picture by <a href="https://pixabay.com/en/brandenburg-gate-berlin-landmark-2010656/">Couleur via Pixabay</a>.</h4>
          </div>
        </div>
      </div>
    </footer>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
         jax: ["input/TeX", "output/HTML-CSS"],
         tex2jax: {
           inlineMath: [ ['$', '$'] ],
           displayMath: [ ['$$', '$$']],
           processEscapes: true,
           skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
         },
         messageStyle: "none",
         "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
        });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66946155-1', 'auto');
  ga('send', 'pageview');

</script>  </body>
</html>