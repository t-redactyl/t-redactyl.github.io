<!DOCTYPE html>
<!--[if IEMobile 7]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html
  class="no-js"
  lang="en"
><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>Creating plots in R using ggplot2 - part 4: stacked bar plots</title>
    <meta name="author" content="Jodie Burchell" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="description" content="Creating plots in R using ggplot2 - part 4: stacked bar plots written January 19, 2016 in r,ggplot2,r graphing tutorials">
  <meta name="keywords" content="rlanguage, ggplot2, data visualisation" />

    <link
      rel="canonical"
      href="https://t-redactyl.github.io/blog/2016/01/creating-plots-in-r-using-ggplot2-part-4-stacked-bar-plots.html"
    />

    <link href="https://t-redactyl.github.io/favicon.png" rel="icon" />

    <link
      href="https://t-redactyl.github.io/feeds/all.atom.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Standard error Full Atom Feed"
    />
      <link
      href="https://t-redactyl.github.io/theme/css/screen.css"
      media="screen, projection"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://t-redactyl.github.io/theme/css/tomorrow.css"
      media="screen, projection"
      rel="stylesheet"
      type="text/css"
    />
     <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- KaTeX for math rendering -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta1/katex.min.css"
      integrity="sha384-VEnyslhHLHiYPca9KFkBB3CMeslnM9CzwjxsEbZTeA21JBm7tdLwKoZmCt3cZTYD"
      crossorigin="anonymous"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta1/katex.min.js"
      integrity="sha384-O4hpKqcplNCe+jLuBVEXC10Rn1QEqAmX98lKAIFBEDxZI0a+6Z2w2n8AEtQbR4CD"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta1/contrib/auto-render.min.js"
      integrity="sha384-IiI65aU9ZYub2MY9zhtKd1H2ps7xxf+eb2YFG9lX6uRqpXCvBTOidPRCXCrQ++Uc"
      crossorigin="anonymous"
    ></script>
   </head>
  <body>
    <a href="/" class="home-icon">
      <img src="https://t-redactyl.github.io/theme/images/home.png" />
    </a>
<article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Creating plots in R using ggplot2 - part 4: stacked bar plots</h1>
        <div class="meta">
          written <time datetime="2016-01-19T00:00:00+01:00">January 19, 2016</time>
          in <span class="categories">
            <a href="https://t-redactyl.github.io/tag/r.html">r</a>,            <a href="https://t-redactyl.github.io/tag/ggplot2.html">ggplot2</a>,            <a href="https://t-redactyl.github.io/tag/r-graphing-tutorials.html">r graphing tutorials</a>          </span>
        </div>
        <p>In this fourth tutorial I am doing with <a href="http://pachamaltese.github.io/">Mauricio Vargas Sepúlveda</a>, we will demonstrate some of the many options the <code>ggplot2</code> package has for creating and customising stacked bar plots. We will use the same <a href="http://pachamaltese.github.io/stats/trade-chile-china/copper-data-for-tutorial.csv">dataset</a> from the <a href="http://t-redactyl.github.io/blog/2015/12/creating-plots-in-r-using-ggplot2-part-1-line-plots.html">first</a>&nbsp;post.</p>
<p>If you enjoyed this blog post and found it useful, please consider buying our book! It contains chapters detailing how to build and customise all 11 chart types published on the blog, as well as <span class="caps">LOWESS</span> charts. The book is also actively maintained (unlike the series on the blog) and contains up-to-date <code>ggplot</code> and tidyverse code, and every purchase really helps us out with keeping up with new&nbsp;content.</p>
<p><a href="https://leanpub.com/ggplot-guide"><img alt="ggplot2 book" class="banner" src="/figure/ggplot-book-banner-small.png" title="The Hitchhikers Guide to ggplot2"></a></p>
<p>The first thing to do is load in the data and libraries, as&nbsp;below:</p>
<pre><code class="r">library(ggplot2)
library(ggthemes)
library(extrafont)
library(plyr)
library(scales)
charts.data &lt;- read.csv(&quot;copper-data-for-tutorial.csv&quot;)
</code></pre>

<p>In this tutorial, we will work towards creating the bar plot below. We will take you from a basic stacked bar plot and explain all the customisations we add to the code&nbsp;step-by-step.</p>
<p><img src="/figure/sb_finalresult-1.png" title="plot of chunk sb_finalresult" alt="plot of chunk sb_finalresult" style="display: block; margin: auto;" /></p>
<h3>Basic&nbsp;graph</h3>
<p>In order to initialise a plot we tell ggplot that <code>charts.data</code> is our data, and specify the variables on each axis. We then instruct ggplot to render this as a stacked bar plot by adding the <code>geom_bar</code> command.</p>
<pre><code class="r">charts.data &lt;- read.csv(&quot;copper-data-for-tutorial.csv&quot;)

p4 &lt;- ggplot() + geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data,
                           stat=&quot;identity&quot;)
p4
</code></pre>

<p><img src="/figure/bar14-1.png" title="plot of chunk bar14" alt="plot of chunk bar14" style="display: block; margin: auto;" /></p>
<h3>Adding data&nbsp;labels</h3>
<p>To label the bars according to some variable in the data, we add the <code>label</code> argument to the <code>ggplot(aes())</code> option. In this case, we have labelled the bars with numbers from the <code>export</code> variable.</p>
<pre><code class="r">p4 &lt;- p4 + geom_text(data=charts.data, aes(x = year, y = percentage,
                                             label = paste0(percentage,&quot;%&quot;)), size=4)
p4
</code></pre>

<p><img src="/figure/bar15-1.png" title="plot of chunk bar15" alt="plot of chunk bar15" style="display: block; margin: auto;" /></p>
<h3>Adjusting data labels&nbsp;position</h3>
<p>To adjust the position of the data labels from the default placement, we use the <code>ddply</code> function on the data, and create a new variable called <code>pos</code>. This variable is at the centre of each bar and can be used to specify the position of the labels by assigning it to the <code>y</code> argument in <code>geom_text(aes())</code>.</p>
<pre><code class="r">charts.data &lt;- ddply(charts.data, .(year),
                     transform, pos = cumsum(percentage) - (0.5 * percentage))

p4 &lt;- ggplot() + geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data,
                           stat=&quot;identity&quot;)
p4 &lt;- p4 + geom_text(data=charts.data, aes(x = year, y = pos, label = paste0(percentage,&quot;%&quot;)),
                       size=4)
p4
</code></pre>

<p><img src="/figure/bar16-1.png" title="plot of chunk bar16" alt="plot of chunk bar16" style="display: block; margin: auto;" /></p>
<h3>Adjusting legend&nbsp;position</h3>
<p>To adjust the position of the legend from the default spot of right of the graph, we add the <code>theme</code> option and specify the <code>legend.position="bottom"</code> argument. We can also change the title to blank using the <code>legend.title = element_blank()</code> argument and change the legend shape using the <code>legend.direction="horizontal"</code> argument.</p>
<pre><code class="r">p4 &lt;- p4 + theme(legend.position=&quot;bottom&quot;, legend.direction=&quot;horizontal&quot;,
                   legend.title = element_blank())
p4
</code></pre>

<p><img src="/figure/bar17-1.png" title="plot of chunk bar17" alt="plot of chunk bar17" style="display: block; margin: auto;" /></p>
<h3>Changing variables&nbsp;display</h3>
<p>To change the variables&#8217; displayed name, we need to re-factor our data labels in <code>charts.data</code> data&nbsp;frame.</p>
<pre><code class="r">charts.data &lt;- as.data.frame(charts.data)
charts.data$product &lt;- factor(charts.data$product, levels = c(&quot;copper&quot;,&quot;others&quot;),
                              labels = c(&quot;Copper&quot;,&quot;Pulp wood, Fruit, Salmon &amp; Others&quot;))

p4 &lt;- ggplot() + geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data,
                           stat=&quot;identity&quot;) +
  geom_text(data=charts.data, aes(x = year, y = pos,
                                  label = paste0(percentage,&quot;%&quot;)), size=4) +
  theme(legend.position=&quot;bottom&quot;, legend.direction=&quot;horizontal&quot;, legend.title = element_blank())
p4
</code></pre>

<p><img src="/figure/bar18-1.png" title="plot of chunk bar18" alt="plot of chunk bar18" style="display: block; margin: auto;" /></p>
<h3>Adjusting x-axis&nbsp;scale</h3>
<p>To change the axis tick marks, we use the <code>scale_x_continuous</code> and/or <code>scale_y_continuous</code> commands.</p>
<pre><code class="r">p4 &lt;- p4 + scale_x_continuous(breaks=seq(2006,2014,1))
p4
</code></pre>

<p><img src="/figure/bar19-1.png" title="plot of chunk bar19" alt="plot of chunk bar19" style="display: block; margin: auto;" /></p>
<h3>Adjusting axis, title <span class="amp">&amp;</span>&nbsp;units</h3>
<p>To add a title, we include the option <code>ggtitle</code> and include the name of the graph as a string argument, and to change the axis names we use the <code>labs</code> command.</p>
<pre><code class="r">p4 &lt;- p4 + labs(x=&quot;Year&quot;, y=&quot;Percentage&quot;) +
  scale_y_continuous(labels = dollar_format(suffix = &quot;%&quot;, prefix = &quot;&quot;)) +
  ggtitle(&quot;Composition of Exports to China (%)&quot;)
p4
</code></pre>

<p><img src="/figure/bar20-1.png" title="plot of chunk bar20" alt="plot of chunk bar20" style="display: block; margin: auto;" /></p>
<h3>Adjusting color&nbsp;palette</h3>
<p>To change the colours, we use the <code>scale_colour_manual</code> command. Note that you can reference the specific colours you&#8217;d like to use with specific <span class="caps">HEX</span> codes. You can also reference colours by name, with the full list of colours recognised by R <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">here</a>.</p>
<pre><code class="r">fill &lt;- c(&quot;#5F9EA0&quot;, &quot;#E1B378&quot;)
p4 &lt;- p4 + scale_fill_manual(values=fill)
p4
</code></pre>

<p><img src="/figure/bar21-1.png" title="plot of chunk bar21" alt="plot of chunk bar21" style="display: block; margin: auto;" /></p>
<h3>Using the white&nbsp;theme</h3>
<p>As explained in the previous posts, we can also change the overall look of the graph using themes. We&#8217;ll start using a simple theme customisation by adding <code>theme_bw()</code> after <code>ggplot()</code>. As you can see, we can further tweak the graph using the <code>theme</code> option, which we&#8217;ve used so far to change the&nbsp;legend.</p>
<pre><code class="r">p4 &lt;- ggplot() + theme_bw() +
  geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data, stat=&quot;identity&quot;) +
  geom_text(data=charts.data, aes(x = year, y = pos, label = paste0(percentage,&quot;%&quot;)), size=4) +
  theme(legend.position=&quot;bottom&quot;, legend.direction=&quot;horizontal&quot;,
        legend.title = element_blank()) +
  scale_x_continuous(breaks=seq(2006,2014,1)) +
  scale_y_continuous(labels = dollar_format(suffix = &quot;%&quot;, prefix = &quot;&quot;)) +
  labs(x=&quot;Year&quot;, y=&quot;Percentage&quot;) +
  ggtitle(&quot;Composition of Exports to China (%)&quot;)
p4
</code></pre>

<p><img src="/figure/bar22-1.png" title="plot of chunk bar22" alt="plot of chunk bar22" style="display: block; margin: auto;" /></p>
<h3>Creating an <span class="caps">XKCD</span> style&nbsp;chart</h3>
<p>Of course, you may want to create your own themes as well. <code>ggplot2</code> allows for a very high degree of customisation, including allowing you to use imported fonts. Below is an example of a theme Mauricio was able to create which mimics the visual style of <a href="http://xkcd.com/"><span class="caps">XKCD</span></a>. In order to create this chart, you first need to import the <span class="caps">XKCD</span> font, install it on your machine and load it into R using the <code>extrafont</code> package.
These instructions are taken from <a href="https://www.google.com.au/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0ahUKEwiWzafchdPJAhVBpJQKHe_LDT8QFggbMAA&amp;url=https%3A%2F%2Fcran.r-project.org%2Fweb%2Fpackages%2Fxkcd%2Fvignettes%2Fxkcd-intro.pdf&amp;usg=AFQjCNE-KciGY14e-Q1buYIVmTFC0ht__Q&amp;sig2=DZUwkvIHwfNWtTtkcz94jg">here</a>:</p>
<pre><code class="r">library(extrafont)

download.file(&quot;http://simonsoftware.se/other/xkcd.ttf&quot;,
              dest=&quot;xkcd.ttf&quot;, mode=&quot;wb&quot;)
system(&quot;mkdir ~/.fonts&quot;)
system(&quot;cp xkcd.ttf  ~/.fonts&quot;)
font_import(paths = &quot;~/.fonts&quot;, pattern=&quot;[X/x]kcd&quot;)
fonts()
loadfonts()
</code></pre>

<p>You can then create your&nbsp;graph:</p>
<pre><code class="r">#font_import(pattern=&quot;[X/x]kcd&quot;)
#fonts()

fill &lt;- c(&quot;#56B4E9&quot;, &quot;#F0E442&quot;)

p4 &lt;- ggplot() +
  geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data, stat=&quot;identity&quot;) +
  geom_text(data=charts.data, aes(x = year, y = pos, label = paste0(percentage,&quot;%&quot;)),
            colour=&quot;black&quot;, family=&quot;xkcd-Regular&quot;, size = 5, show.legend = F) +
  theme(legend.position=&quot;bottom&quot;, legend.direction=&quot;horizontal&quot;,
        legend.title = element_blank()) +
  scale_x_continuous(breaks=seq(2006,2014,1)) +
  scale_y_continuous(labels = dollar_format(suffix = &quot;%&quot;, prefix = &quot;&quot;)) +
  labs(x=&quot;Year&quot;, y=&quot;Percentage&quot;) +
  ggtitle(&quot;Composition of Exports to China (%)&quot;) +
  scale_fill_manual(values=fill) +
  theme(axis.line = element_line(size=1, colour = &quot;black&quot;),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank()) +
  theme(plot.title=element_text(family=&quot;xkcd-Regular&quot;), text=element_text(family=&quot;xkcd-Regular&quot;),
        axis.text.x=element_text(colour=&quot;black&quot;, size = 10),
        axis.text.y=element_text(colour=&quot;black&quot;, size = 10))
p4
</code></pre>

<p><img src="/figure/bar25-1.png" title="plot of chunk bar25" alt="plot of chunk bar25" style="display: block; margin: auto;" /></p>
<h3>Using &#8216;The Economist&#8217;&nbsp;theme</h3>
<p>There are a wider range of pre-built themes available as part of the <code>ggthemes</code> package (more information on these <a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html">here</a>). Below we&#8217;ve applied <code>theme_economist()</code>, which approximates graphs in the Economist magazine. It is also important that the font change argument inside <code>theme</code> is optional and it&#8217;s only to obtain a more similar result compared to the original. For an exact result you need &#8216;Officina Sans&#8217; which is a commercial font and is available <a href="http://www.myfonts.com/fonts/itc/officina-sans/">here</a>.</p>
<pre><code class="r">p4 &lt;- ggplot() + theme_economist() + scale_fill_economist() +
  theme(plot.title=element_text(family=&quot;OfficinaSanITC-Book&quot;),
        text=element_text(family=&quot;OfficinaSanITC-Book&quot;)) +
  geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data, stat=&quot;identity&quot;) +
  geom_text(data=charts.data, aes(x = year, y = pos, label = paste0(percentage,&quot;%&quot;)),
            colour=&quot;white&quot;, family=&quot;OfficinaSanITC-Book&quot;, size=4) +
  theme(legend.position=&quot;bottom&quot;, legend.direction=&quot;horizontal&quot;,
        legend.title = element_blank()) +
  scale_x_continuous(breaks=seq(2006,2014,1)) +
  scale_y_continuous(labels = dollar_format(suffix = &quot;%&quot;, prefix = &quot;&quot;)) +
  labs(x=&quot;Year&quot;, y=&quot;Percentage&quot;) +
  ggtitle(&quot;Composition of Exports to China (%)&quot;)
p4
</code></pre>

<p><img src="/figure/bar23-1.png" title="plot of chunk bar23" alt="plot of chunk bar23" style="display: block; margin: auto;" /></p>
<h3>Using &#8216;Five Thirty Eight&#8217;&nbsp;theme</h3>
<p>Below we&#8217;ve applied <code>theme_fivethirtyeight()</code>, which approximates graphs in the nice <a href="http://fivethirtyeight.com/">FiveThirtyEight</a> website. Again, it is also important that the font change is optional and it&#8217;s only to obtain a more similar result compared to the original. For an exact result you need &#8216;Atlas Grotesk&#8217; which is a commercial font and is available <a href="https://commercialtype.com/catalog/atlas">here</a>.</p>
<pre><code class="r">p4 &lt;- ggplot() + theme_fivethirtyeight() + scale_fill_fivethirtyeight() +   
  theme(plot.title=element_text(family=&quot;Atlas Grotesk Medium&quot;),
        text=element_text(family=&quot;Atlas Grotesk Light&quot;)) +
  geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data, stat=&quot;identity&quot;) +
  geom_text(data=charts.data, aes(x = year, y = pos, label = paste0(percentage,&quot;%&quot;)),
            colour=&quot;white&quot;, family=&quot;Atlas Grotesk Medium&quot;, size=4) +
  theme(legend.position=&quot;bottom&quot;, legend.direction=&quot;horizontal&quot;,
        legend.title = element_blank()) +
  scale_x_continuous(breaks=seq(2006,2014,1)) +
  scale_y_continuous(labels = dollar_format(suffix = &quot;%&quot;, prefix = &quot;&quot;)) +
  labs(x=&quot;Year&quot;, y=&quot;Percentage&quot;) +
  ggtitle(&quot;Composition of Exports to China (%)&quot;)
p4
</code></pre>

<p><img src="/figure/bar24-1.png" title="plot of chunk bar24" alt="plot of chunk bar24" style="display: block; margin: auto;" /></p>
<h3>Creating your own&nbsp;theme</h3>
<p>As before, you can modify your plots a lot as <code>ggplot2</code> allows many customisations. Here we present our original result shown at the top of&nbsp;page.</p>
<pre><code class="r">fill &lt;- c(&quot;#40b8d0&quot;, &quot;#b2d183&quot;)

p4 &lt;- ggplot() +
  geom_bar(aes(y = percentage, x = year, fill = product), data = charts.data, stat=&quot;identity&quot;) +
  geom_text(data=charts.data, aes(x = year, y = pos, label = paste0(percentage,&quot;%&quot;)),
            colour=&quot;black&quot;, family=&quot;Tahoma&quot;, size=4) +
  theme(legend.position=&quot;bottom&quot;, legend.direction=&quot;horizontal&quot;,
        legend.title = element_blank()) +
  scale_x_continuous(breaks=seq(2006,2014,1)) +
  scale_y_continuous(labels = dollar_format(suffix = &quot;%&quot;, prefix = &quot;&quot;)) +
  labs(x=&quot;Year&quot;, y=&quot;Percentage&quot;) +
  ggtitle(&quot;Composition of Exports to China (%)&quot;) +
  scale_fill_manual(values=fill) +
  theme(axis.line = element_line(size=1, colour = &quot;black&quot;),
        panel.grid.major = element_line(colour = &quot;#d3d3d3&quot;), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank()) +
  theme(plot.title = element_text(size = 14, family = &quot;Tahoma&quot;, face = &quot;bold&quot;),
        text=element_text(family=&quot;Tahoma&quot;),
        axis.text.x=element_text(colour=&quot;black&quot;, size = 10),
        axis.text.y=element_text(colour=&quot;black&quot;, size = 10))
p4
</code></pre>

<p><img src="/figure/bar26-1.png" title="plot of chunk bar26" alt="plot of chunk bar26" style="display: block; margin: auto;" /></p>
        <hr class="divider-short"/>
        <!-- Disqus goes here -->
        <!-- <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite">Disqus goes here</div>
        </section>
        -->
      </div>
    </div>
  </div>
</article>
    <footer id="footer" class="her-row">
      <div class="container">
        <div class="row">
          <div class="col-md-1">
            <a href="/"><h4>Home</h4></a>
          </div>

          <div class="col-md-2">
            <div class="social-icon-list">
              <a href="https://twitter.com/t_redactyl"
                ><img
                  src="https://t-redactyl.github.io/theme/images/glyphicons_social_31_twitter.png"
              /></a>
               <a href="https://github.com/t-redactyl"
                ><img
                  src="https://t-redactyl.github.io/theme/images/glyphicons_social_21_github.png"
              /></a>
              </div>
          </div>
          <div class="pull-right">
            <h4>
              Powered by <a href="http://blog.getpelican.com/">Pelican</a>.
              Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.
              Title picture by
              <a
                href="https://pixabay.com/en/brandenburg-gate-berlin-landmark-2010656/"
                >Couleur via Pixabay</a
              >.
            </h4>
          </div>
        </div>
      </div>
    </footer>

    <!-- KaTeX rendering -->
    <script>
      renderMathInElement(document.body);
    </script>

 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66946155-1', 'auto');
  ga('send', 'pageview');

</script>    </body>
</html>