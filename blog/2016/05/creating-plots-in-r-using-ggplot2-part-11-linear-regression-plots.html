<!DOCTYPE html>
<!--[if IEMobile 7]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html
  class="no-js"
  lang="en"
><!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <title>Creating plots in R using ggplot2 - part 11: linear regression plots</title>
    <meta name="author" content="Jodie Burchell" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="description" content="Creating plots in R using ggplot2 - part 11: linear regression plots written May 11, 2016 in r,ggplot2,r graphing tutorials">
  <meta name="keywords" content="rlanguage, ggplot2, data visualisation" />

    <link
      rel="canonical"
      href="https://t-redactyl.github.io/blog/2016/05/creating-plots-in-r-using-ggplot2-part-11-linear-regression-plots.html"
    />

    <link href="https://t-redactyl.github.io/favicon.png" rel="icon" />

    <link
      href="https://t-redactyl.github.io/feeds/all.atom.xml"
      type="application/atom+xml"
      rel="alternate"
      title="Standard error Full Atom Feed"
    />
      <link
      href="https://t-redactyl.github.io/theme/css/screen.css"
      media="screen, projection"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://t-redactyl.github.io/theme/css/tomorrow.css"
      media="screen, projection"
      rel="stylesheet"
      type="text/css"
    />
     <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- KaTeX for math rendering -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta1/katex.min.css"
      integrity="sha384-VEnyslhHLHiYPca9KFkBB3CMeslnM9CzwjxsEbZTeA21JBm7tdLwKoZmCt3cZTYD"
      crossorigin="anonymous"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta1/katex.min.js"
      integrity="sha384-O4hpKqcplNCe+jLuBVEXC10Rn1QEqAmX98lKAIFBEDxZI0a+6Z2w2n8AEtQbR4CD"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-beta1/contrib/auto-render.min.js"
      integrity="sha384-IiI65aU9ZYub2MY9zhtKd1H2ps7xxf+eb2YFG9lX6uRqpXCvBTOidPRCXCrQ++Uc"
      crossorigin="anonymous"
    ></script>
   </head>
  <body>
    <a href="/" class="home-icon">
      <img src="https://t-redactyl.github.io/theme/images/home.png" />
    </a>
<article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Creating plots in R using ggplot2 - part 11: linear regression plots</h1>
        <div class="meta">
          written <time datetime="2016-05-11T00:00:00+02:00">May 11, 2016</time>
          in <span class="categories">
            <a href="https://t-redactyl.github.io/tag/r.html">r</a>,            <a href="https://t-redactyl.github.io/tag/ggplot2.html">ggplot2</a>,            <a href="https://t-redactyl.github.io/tag/r-graphing-tutorials.html">r graphing tutorials</a>          </span>
        </div>
        <p>This is the eleventh tutorial in a series on using <code>ggplot2</code> I am creating with <a href="http://pachamaltese.github.io/">Mauricio Vargas Sepúlveda</a>. In this tutorial we will demonstrate some of the many options the <code>ggplot2</code> package has for creating linear regression&nbsp;plots.</p>
<p>If you enjoyed this blog post and found it useful, please consider buying our book! It contains chapters detailing how to build and customise all 11 chart types published on the blog, as well as <span class="caps">LOWESS</span> charts. The book is also actively maintained (unlike the series on the blog) and contains up-to-date <code>ggplot</code> and tidyverse code, and every purchase really helps us out with keeping up with new&nbsp;content.</p>
<p><a href="https://leanpub.com/ggplot-guide"><img alt="ggplot2 book" class="banner" src="/figure/ggplot-book-banner-small.png" title="The Hitchhikers Guide to ggplot2"></a></p>
<p>This post will be much more than showing you how to create regression plots. Here we are extracting, cleaning and processing financial data from <a href="https://www.quandl.com/">Quandl</a>.</p>
<p>Before going ahead, we strongly suggest to create a <a href="https://www.quandl.com/">Quandl</a> account in order to obtain an <a href="https://www.quandl.com/account/api"><span class="caps">API</span> key</a> that allows you to download data without restrictions. It is even possible to log into Quandl using Github or Linkedin accounts. Quandl&#8217;s website has complete instruction and they have an <span class="caps">API</span> that is 100% R&nbsp;compatible.</p>
<p>The goal is to estimate the <span class="caps">CAPM</span> model <span class="math">\(R_i = R_f + \beta_i [R_m - R_f] + e_i\)</span> where <span class="math">\(R_i\)</span> is the return of an asset, <span class="math">\(R_f\)</span> is the risk-free return (e.g. <span class="caps">US</span> Treasury Bonds), <span class="math">\(R_m\)</span> is the return of the market portfolio (e.g. <span class="caps">NYSE</span>) and <span class="math">\(\beta_i\)</span> is  a measure of risk relative to the market (e.g. <span class="math">\(\beta_i = 1\)</span> means that asset is exactly as risky as the market portfolio). More on the <span class="caps">CAPM</span> model can be read <a href="http://people.stern.nyu.edu/ashapiro/courses/B01.231103/FFL09.pdf">here</a>, but in this tutorial we will focus on&nbsp;plotting.</p>
<p>In this tutorial, we will work towards creating the trend line and diagnostics plots below. We will take you from a basic regression plot and explain all the customisations we add to the code&nbsp;step-by-step.</p>
<p><img src="/figure/lr_final-1.png" title="plot of chunk lr_final" alt="plot of chunk lr_final" style="display: block; margin: auto;" /><img src="/figure/lr_final-2.png" title="plot of chunk lr_final" alt="plot of chunk lr_final" style="display: block; margin: auto;" /></p>
<p>The first thing to do is download and load in the data of the monthly price of Hang Seng Index and Cheung Kong Holdings Hong Kong from 2015-03-01 to&nbsp;2016-04-01.</p>
<pre><code class="r">library(ggplot2)
library(Quandl)
Quandl.api_key(&quot;XXX&quot;)

hsi.df &lt;- Quandl(&quot;YAHOO/INDEX_HSI&quot;, start_date=&quot;2015-03-01&quot;, end_date=&quot;2016-04-01&quot;,
                 collapse=&quot;monthly&quot;, type = &quot;raw&quot;)

ckh.df &lt;- Quandl(&quot;YAHOO/HK_0001&quot;, start_date=&quot;2015-03-01&quot;,
                 end_date=&quot;2016-04-01&quot;, collapse=&quot;monthly&quot;, type = &quot;raw&quot;)

saveRDS(hsi.df, &quot;hsi.rds&quot;); saveRDS(ckh.df,&quot;ckh.rds&quot;)
</code></pre>

<p>Before calculating return as <span class="math">\(R_i = \displaystyle \frac{P_t - P_{t-1}}{P_t}\)</span> we need to order <span class="caps">HSI</span> and <span class="caps">CKH</span> data by dates and in decreasing&nbsp;order.</p>
<pre><code class="r">hsi.df &lt;- readRDS(&quot;hsi.rds&quot;)
colnames(hsi.df)[7] &lt;- &quot;Adjusted.Close&quot;
hsi.df &lt;- hsi.df[order(as.Date(hsi.df$Date)),]
</code></pre>

<p>With ordered dates it is possible to obtain the correct return for each&nbsp;month.</p>
<pre><code class="r">hsi.Adjusted.Close &lt;- hsi.df$Adjusted.Close
hsi.Return &lt;- diff(hsi.Adjusted.Close)/hsi.Adjusted.Close[-length(hsi.Adjusted.Close)]
hsi.Return &lt;- c(NA,hsi.Return)
hsi.df$Return &lt;- hsi.Return
hsi.df &lt;- na.omit(hsi.df)
hsi.Return &lt;- hsi.df[,c(&quot;Date&quot;,&quot;Return&quot;)]

ckh.df &lt;- readRDS(&quot;ckh.rds&quot;)
colnames(ckh.df)[7] &lt;- &quot;Adjusted.Close&quot;
ckh.df &lt;- ckh.df[order(as.Date(ckh.df$Date)),]
ckh.Adjusted.Close &lt;- ckh.df$Adjusted.Close
ckh.Return &lt;- diff(ckh.Adjusted.Close)/ckh.Adjusted.Close[-length(ckh.Adjusted.Close)]
ckh.Return &lt;- c(NA,ckh.Return)
ckh.df &lt;- na.omit(ckh.df)
ckh.df$Return &lt;- ckh.Return
ckh.Return &lt;- ckh.df[,c(&quot;Date&quot;,&quot;Return&quot;)]
</code></pre>

<p>The returns can be arranged in one data frame before doing plots and&nbsp;regression.</p>
<pre><code class="r">hsi.ckh.returns &lt;- merge(hsi.Return, ckh.Return, by='Date')
hsi.ckh.returns &lt;- na.omit(hsi.ckh.returns)
colnames(hsi.ckh.returns) &lt;- c(&quot;Date&quot;,&quot;hsi.Return&quot;,&quot;ckh.Return&quot;)
</code></pre>

<p>Using <a href="http://pages.stern.nyu.edu/~adamodar/New_Home_Page/datafile/ctryprem.html">Damodaran</a> and <a href="http://www.bloomberg.com/markets/rates-bonds/government-bonds/us">Bloomberg</a> data we can work with an estimate of <span class="caps">HSI</span> risk premium over risk-free&nbsp;rate.</p>
<pre><code class="r">usa.risk.free &lt;- 0.3/100
hsi.risk.premium &lt;- 0.6/100
</code></pre>

<h2>Trend line&nbsp;plot</h2>
<h3>Basic trend line&nbsp;plot</h3>
<p>Now we can fit a linear regression. One interesting thing is that in <span class="caps">CAPM</span> context the regression line slope can be calculated as <span class="math">\(\beta_i = \displaystyle \frac{\sigma_{i,m}}{\sigma_m^2}\)</span>.</p>
<pre><code class="r">hsi.ckh.returns$hsi.Risk.free &lt;- usa.risk.free + hsi.risk.premium
hsi.ckh.returns$hsi.Risk.premium &lt;- hsi.ckh.returns$hsi.Return - hsi.ckh.returns$hsi.Risk.free
hsi.Return.vector &lt;- as.vector(hsi.ckh.returns$hsi.Return)
ckh.Return.vector &lt;- as.vector(hsi.ckh.returns$ckh.Return)
cov.hsi.ckh &lt;- cov(ckh.Return.vector, hsi.Return.vector)
var.hk &lt;- var(hsi.Return.vector)
capm_beta = cov.hsi.ckh/var.hk

fit &lt;- lm(ckh.Return ~ hsi.Risk.premium, data = hsi.ckh.returns)
summary(fit)
</code></pre>

<pre><code>
Call:
lm(formula = ckh.Return ~ hsi.Risk.premium, data = hsi.ckh.returns)

Residuals:
      Min        1Q    Median        3Q       Max
-0.031033 -0.022800  0.001032  0.010137  0.050709

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      0.007142   0.007437   0.960    0.357    
hsi.Risk.premium 0.671372   0.101209   6.634 3.69e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.02565 on 11 degrees of freedom
Multiple R-squared:    0.8, Adjusted R-squared:  0.7818
F-statistic:    44 on 1 and 11 DF,  p-value: 3.692e-05
</code></pre>

<p>Up to this point we have all we need to plot regressions. We will start with a basic regression&nbsp;plot.</p>
<pre><code class="r">p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) + geom_point(shape=1) + geom_smooth(method=lm)
p11
</code></pre>

<p><img src="/figure/lr_6-1.png" title="plot of chunk lr_6" alt="plot of chunk lr_6" style="display: block; margin: auto;" /></p>
<p><code>geom_smooth</code> can be customized, for example, not to include the confidence&nbsp;region</p>
<pre><code class="r">p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) + geom_point(shape=1) + geom_smooth(method=lm, se=FALSE)
p11
</code></pre>

<p><img src="/figure/lr_7-1.png" title="plot of chunk lr_7" alt="plot of chunk lr_7" style="display: block; margin: auto;" /></p>
<p>Before continuing it is a good idea to fix the axis labels and add a&nbsp;title.</p>
<h3>Customising axis&nbsp;labels</h3>
<p>We can change the text of the axis labels using the <code>scale_x_continuous</code> and <code>scale_y_continuous</code> options, with the names passed as a string to the <code>name</code> arguments in&nbsp;each.</p>
<pre><code class="r">p11 &lt;- p11 + scale_x_continuous(name = &quot;HSI risk premium&quot;) +
      scale_y_continuous(name = &quot;CKH return&quot;)
p11
</code></pre>

<p><img src="/figure/lr_8-1.png" title="plot of chunk lr_8" alt="plot of chunk lr_8" style="display: block; margin: auto;" /></p>
<h3>Adding a&nbsp;title</h3>
<p>Similarly, we can add a title using the <code>ggtitle</code> option.</p>
<pre><code class="r">p11 &lt;- p11 + ggtitle(&quot;CKH regression line&quot;)
p11
</code></pre>

<p><img src="/figure/lr_9-1.png" title="plot of chunk lr_9" alt="plot of chunk lr_9" style="display: block; margin: auto;" /></p>
<h3>Including regression&nbsp;coefficients</h3>
<p>We can also include more information about the regression line itself. It would be interesting to show <span class="math">\(R^2\)</span> and regression coefficients within the&nbsp;plot.</p>
<pre><code class="r">p11 &lt;- p11 + annotate(&quot;text&quot;, x=0.1, y=-0.05, label = &quot;R^2=0.78&quot;) +
      annotate(&quot;text&quot;, x=0.1, y=-0.06, label = &quot;alpha=0.00&quot;) +
      annotate(&quot;text&quot;, x=0.1, y=-0.07, label = &quot;beta=0.67&quot;)
p11
</code></pre>

<p><img src="/figure/lr_10-1.png" title="plot of chunk lr_10" alt="plot of chunk lr_10" style="display: block; margin: auto;" /></p>
<p>Another option would be to add greek letters and&nbsp;exponents.</p>
<pre><code class="r">p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) + geom_point(shape=1) +
      geom_smooth(method=lm, se=FALSE) + ggtitle(&quot;CKH regression line&quot;) +
      scale_x_continuous(name = &quot;HSI risk premium&quot;) +
      scale_y_continuous(name = &quot;CKH return&quot;) +
      annotate(&quot;text&quot;, x=0.1, y=-0.05, label = &quot;R^2 == 0.78&quot;, parse=T) +
      annotate(&quot;text&quot;, x=0.1, y=-0.06, label = &quot;alpha == 0.00&quot;, parse=T) +
      annotate(&quot;text&quot;, x=0.1, y=-0.07, label = &quot;beta == 0.67&quot;, parse=T)
p11
</code></pre>

<p><img src="/figure/lr_11-1.png" title="plot of chunk lr_11" alt="plot of chunk lr_11" style="display: block; margin: auto;" /></p>
<p>To make the coefficients more clear we will add some elements to increase&nbsp;visibility.</p>
<pre><code class="r">p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) +
      geom_point(shape=1) + geom_smooth(method=lm, se=FALSE) +
      ggtitle(&quot;CKH regression line&quot;) +
      scale_x_continuous(name = &quot;HSI risk premium&quot;) +
      scale_y_continuous(name = &quot;CKH return&quot;) +
      annotate(&quot;rect&quot;, xmin = 0.075, xmax = 0.125, ymin = -0.075, ymax = -0.045, fill=&quot;white&quot;, colour=&quot;red&quot;) +
      annotate(&quot;text&quot;, x=0.1, y=-0.05, label = &quot;R^2 == 0.78&quot;, parse=T) + annotate(&quot;text&quot;, x=0.1, y=-0.06, label = &quot;alpha == 0.00&quot;, parse=T) +
      annotate(&quot;text&quot;, x=0.1, y=-0.07, label = &quot;beta == 0.67&quot;, parse=T)
p11
</code></pre>

<p><img src="/figure/lr_12-1.png" title="plot of chunk lr_12" alt="plot of chunk lr_12" style="display: block; margin: auto;" /></p>
<p>Another customization could be to show the trend line using rounded digits (or even significant digits) from regression coefficients. This requires us to write a function and is not as easy to obtain as the last&nbsp;plot.</p>
<pre><code class="r">equation = function(x) {
  lm_coef &lt;- list(a = round(coef(x)[1], digits = 2),
                  b = round(coef(x)[2], digits = 2),
                  r2 = round(summary(x)$r.squared, digits = 2));
  lm_eq &lt;- substitute(italic(y) == a + b %.% italic(x)*&quot;,&quot;~~italic(R)^2~&quot;=&quot;~r2,lm_coef)
  as.character(as.expression(lm_eq));                 
}

p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) + geom_point(shape=1) + geom_smooth(method=lm, se=FALSE) +
      ggtitle(&quot;CKH regression line&quot;) +
      scale_x_continuous(name = &quot;HSI risk premium&quot;) +
      scale_y_continuous(name = &quot;CKH return&quot;) +
      annotate(&quot;rect&quot;, xmin = 0.00, xmax = 0.1, ymin = -0.056, ymax = -0.044, fill=&quot;white&quot;, colour=&quot;red&quot;) +
      annotate(&quot;text&quot;, x = 0.05, y = -0.05, label = equation(fit), parse = TRUE)
p11
</code></pre>

<p><img src="/figure/lr_13-1.png" title="plot of chunk lr_13" alt="plot of chunk lr_13" style="display: block; margin: auto;" /></p>
<h3>Using the white&nbsp;theme</h3>
<p>As explained in the previous posts, we can also change the overall look of the plot using themes. We&#8217;ll start using a simple theme customisation by adding <code>theme_bw()</code>. As you can see, we can further tweak the graph using the <code>theme</code> option, which we&#8217;ve used so far to change the&nbsp;legend.</p>
<pre><code class="r">p11 &lt;- p11 + theme_bw()
p11
</code></pre>

<p><img src="/figure/lr_14-1.png" title="plot of chunk lr_14" alt="plot of chunk lr_14" style="display: block; margin: auto;" /></p>
<h3>Creating an <span class="caps">XKCD</span> style&nbsp;chart</h3>
<p>Of course, you may want to create your own themes as well. <code>ggplot2</code> allows for a very high degree of customisation, including allowing you to use imported fonts. Below is an example of a theme Mauricio was able to create which mimics the visual style of <a href="http://xkcd.com/"><span class="caps">XKCD</span></a>. In order to create this chart, you first need to import the <span class="caps">XKCD</span> font, install it on your machine and load it into R using the <code>extrafont</code> package.
These instructions are taken from <a href="https://www.google.com.au/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0ahUKEwiWzafchdPJAhVBpJQKHe_LDT8QFggbMAA&amp;url=https%3A%2F%2Fcran.r-project.org%2Fweb%2Fpackages%2Fxkcd%2Fvignettes%2Fxkcd-intro.pdf&amp;usg=AFQjCNE-KciGY14e-Q1buYIVmTFC0ht__Q&amp;sig2=DZUwkvIHwfNWtTtkcz94jg">here</a>:</p>
<pre><code class="r">library(extrafont)

download.file(&quot;http://simonsoftware.se/other/xkcd.ttf&quot;,
              dest=&quot;xkcd.ttf&quot;, mode=&quot;wb&quot;)
system(&quot;mkdir ~/.fonts&quot;)
system(&quot;cp xkcd.ttf  ~/.fonts&quot;)
font_import(paths = &quot;~/.fonts&quot;, pattern=&quot;[X/x]kcd&quot;)
fonts()
loadfonts()
</code></pre>

<p>You can then create your&nbsp;graph:</p>
<pre><code class="r">p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) + geom_point(shape=1) + geom_smooth(method=lm, se=FALSE) +
      ggtitle(&quot;CKH regression line&quot;) +
      scale_x_continuous(name = &quot;HSI risk premium&quot;) +
      scale_y_continuous(name = &quot;CKH return&quot;) +
      annotate(&quot;rect&quot;, xmin = 0.00, xmax = 0.1, ymin = -0.056, ymax = -0.044, fill=&quot;white&quot;, colour=&quot;red&quot;) +
      annotate(&quot;text&quot;, x = 0.05, y = -0.05, label = equation(fit), parse = TRUE) +
      theme(axis.line.x = element_line(size=.5, colour = &quot;black&quot;),
            axis.line.y = element_line(size=.5, colour = &quot;black&quot;),
            axis.text.x=element_text(colour=&quot;black&quot;, size = 9),
            axis.text.y=element_text(colour=&quot;black&quot;, size = 9),
            panel.grid.major = element_line(colour = &quot;#d3d3d3&quot;),
            panel.grid.minor = element_blank(),
            panel.border = element_blank(), panel.background = element_blank(),
            plot.title = element_text(family = &quot;xkcd-Regular&quot;),
            text=element_text(family=&quot;xkcd-Regular&quot;))
p11
</code></pre>

<p><img src="/figure/lr_15-1.png" title="plot of chunk lr_15" alt="plot of chunk lr_15" style="display: block; margin: auto;" /></p>
<h3>Using &#8216;The Economist&#8217;&nbsp;theme</h3>
<p>There are a wider range of pre-built themes available as part of the <code>ggthemes</code> package (more information on these <a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html">here</a>). Below we&#8217;ve applied <code>theme_economist()</code>, which approximates graphs in the Economist&nbsp;magazine.</p>
<pre><code class="r">library(ggthemes)
library(grid)

fill &lt;- &quot;#4271AE&quot;
line &lt;- &quot;#1F3552&quot;

p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) + geom_point(shape=1) + geom_smooth(method=lm, se=FALSE) +
      ggtitle(&quot;CKH regression line&quot;) +
      scale_x_continuous(name = &quot;HSI risk premium&quot;) +
      scale_y_continuous(name = &quot;CKH return&quot;) +
      annotate(&quot;rect&quot;, xmin = -0.002, xmax = 0.102, ymin = -0.056, ymax = -0.044, fill=&quot;white&quot;, colour=&quot;red&quot;) +
      annotate(&quot;text&quot;, x = 0.05, y = -0.05, label = equation(fit), parse = TRUE) +
      theme_economist() +
      theme(axis.line.x = element_line(size=.5, colour = &quot;black&quot;),
            axis.line.y = element_line(size=.5, colour = &quot;black&quot;),
            axis.text.x=element_text(colour=&quot;black&quot;, size = 9),
            axis.text.y=element_text(colour=&quot;black&quot;, size = 9),
            panel.grid.major = element_line(colour = &quot;#d3d3d3&quot;),
            panel.grid.minor = element_blank(),
            panel.border = element_blank(), panel.background = element_blank(),
            plot.title = element_text(family = &quot;OfficinaSanITC-Book&quot;),
            text=element_text(family=&quot;OfficinaSanITC-Book&quot;))
p11
</code></pre>

<p><img src="/figure/lr_16-1.png" title="plot of chunk lr_15" alt="plot of chunk lr_15" style="display: block; margin: auto;" /></p>
<h3>Creating your own&nbsp;theme</h3>
<p>As before, you can modify your plots a lot as <code>ggplot2</code> allows many customisations. Here is a custom plot where we have modified the axes, background and&nbsp;font.</p>
<pre><code class="r">library(grid)

fill &lt;- &quot;#4271AE&quot;
lines &lt;- &quot;#1F3552&quot;

p11 &lt;- ggplot(hsi.ckh.returns, aes(x=hsi.Risk.premium, y=ckh.Return)) + geom_point(shape=1) + geom_smooth(method=lm, se=FALSE) +
      ggtitle(&quot;CKH regression line&quot;) +
      scale_x_continuous(name = &quot;HSI risk premium&quot;) +
      scale_y_continuous(name = &quot;CKH return&quot;) +
      annotate(&quot;rect&quot;, xmin = 0.00, xmax = 0.1, ymin = -0.056, ymax = -0.044, fill=&quot;white&quot;, colour=&quot;red&quot;) +
      annotate(&quot;text&quot;, x = 0.05, y = -0.05, label = equation(fit), parse = TRUE) +
      theme(axis.line.x = element_line(size=.5, colour = &quot;black&quot;),
            axis.line.y = element_line(size=.5, colour = &quot;black&quot;),
            axis.text.x=element_text(colour=&quot;black&quot;, size = 9),
            axis.text.y=element_text(colour=&quot;black&quot;, size = 9),
            legend.position = &quot;bottom&quot;, legend.position = &quot;horizontal&quot;,
            panel.grid.major = element_line(colour = &quot;#d3d3d3&quot;),
            panel.grid.minor = element_blank(),
            panel.border = element_blank(), panel.background = element_blank(),
            plot.title = element_text(size = 14, family = &quot;Tahoma&quot;, face = &quot;bold&quot;),
            text=element_text(family=&quot;Tahoma&quot;))
p11
</code></pre>

<p><img src="/figure/lr_17-1.png" title="plot of chunk lr_17" alt="plot of chunk lr_17" style="display: block; margin: auto;" /></p>
<h2>Regression diagnostics&nbsp;plots</h2>
<h3>Basic diagnostics&nbsp;plots</h3>
<p>An important part of creating regression models is evaluating how well they fit the data. We can use the package <code>ggfortify</code> to let <code>ggplot2</code> interpret <code>lm</code> objects and create diagnostic&nbsp;plots.</p>
<pre><code class="r"># install.packages(&quot;ggfortify&quot;)
library(ggfortify)
autoplot(fit, label.size = 3)
</code></pre>

<p><img src="/figure/lr_18-1.png" title="plot of chunk lr_18" alt="plot of chunk lr_18" style="display: block; margin: auto;" /></p>
<h3>Using the white&nbsp;theme</h3>
<p>We can also customise the appearance of our diagnostic plots. Let&#8217;s first use the white theme by again adding <code>theme_bw()</code>.</p>
<pre><code class="r">autoplot(fit, label.size = 3) + theme_bw()
</code></pre>

<p><img src="/figure/lr_19-1.png" title="plot of chunk lr_19" alt="plot of chunk lr_19" style="display: block; margin: auto;" /></p>
<h3>Creating an <span class="caps">XKCD</span> style&nbsp;chart</h3>
<p>We can of course apply our other themes as well. Let&#8217;s try the <span class="caps">XKCD</span>&nbsp;theme.</p>
<pre><code class="r">autoplot(fit, label.size = 3) + theme(axis.line.x = element_line(size=.5, colour = &quot;black&quot;),
            axis.line.y = element_line(size=.5, colour = &quot;black&quot;),
            axis.text.x=element_text(colour=&quot;black&quot;, size = 9),
            axis.text.y=element_text(colour=&quot;black&quot;, size = 9),
            panel.grid.major = element_line(colour = &quot;#d3d3d3&quot;),
            panel.grid.minor = element_blank(),
            panel.border = element_blank(), panel.background = element_blank(),
            plot.title = element_text(family = &quot;xkcd-Regular&quot;),
            text=element_text(family=&quot;xkcd-Regular&quot;))
</code></pre>

<p><img src="/figure/lr_20-1.png" title="plot of chunk lr_20" alt="plot of chunk lr_20" style="display: block; margin: auto;" /></p>
<h3>Using &#8216;The Economist&#8217;&nbsp;theme</h3>
<p>And now the Economist&nbsp;theme.</p>
<pre><code class="r">autoplot(fit, label.size = 3) + theme_economist() +
      theme(axis.line.x = element_line(size=.5, colour = &quot;black&quot;),
            axis.line.y = element_line(size=.5, colour = &quot;black&quot;),
            axis.text.x=element_text(colour=&quot;black&quot;, size = 9),
            axis.text.y=element_text(colour=&quot;black&quot;, size = 9),
            panel.grid.major = element_line(colour = &quot;#d3d3d3&quot;),
            panel.grid.minor = element_blank(),
            panel.border = element_blank(), panel.background = element_blank(),
            plot.title = element_text(family = &quot;OfficinaSanITC-Book&quot;),
            text=element_text(family=&quot;OfficinaSanITC-Book&quot;))
</code></pre>

<p><img src="/figure/lr_21-1.png" title="plot of chunk lr_20" alt="plot of chunk lr_20" style="display: block; margin: auto;" /></p>
<h3>Creating your own&nbsp;theme</h3>
<p>Finally, we can also fully customise the diagnostic plots to match our regression plot simply by applying all of the same theme&nbsp;options.</p>
<pre><code class="r">autoplot(fit, label.size = 3) + theme(axis.line.x = element_line(size=.5, colour = &quot;black&quot;),
            axis.line.y = element_line(size=.5, colour = &quot;black&quot;),
            axis.text.x=element_text(colour=&quot;black&quot;, size = 9),
            axis.text.y=element_text(colour=&quot;black&quot;, size = 9),
            legend.position = &quot;bottom&quot;, legend.position = &quot;horizontal&quot;,
            panel.grid.major = element_line(colour = &quot;#d3d3d3&quot;),
            panel.grid.minor = element_blank(),
            panel.border = element_blank(), panel.background = element_blank(),
            plot.title = element_text(size = 14, family = &quot;Tahoma&quot;, face = &quot;bold&quot;),
            text=element_text(family=&quot;Tahoma&quot;))
</code></pre>

<p><img src="/figure/lr_22-1.png" title="plot of chunk lr_22" alt="plot of chunk lr_22" style="display: block; margin: auto;" /></p>
        <hr class="divider-short"/>
        <!-- Disqus goes here -->
        <!-- <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite">Disqus goes here</div>
        </section>
        -->
      </div>
    </div>
  </div>
</article>
    <footer id="footer" class="her-row">
      <div class="container">
        <div class="row">
          <div class="col-md-1">
            <a href="/"><h4>Home</h4></a>
          </div>

          <div class="col-md-2">
            <div class="social-icon-list">
              <a href="https://twitter.com/t_redactyl"
                ><img
                  src="https://t-redactyl.github.io/theme/images/glyphicons_social_31_twitter.png"
              /></a>
               <a href="https://github.com/t-redactyl"
                ><img
                  src="https://t-redactyl.github.io/theme/images/glyphicons_social_21_github.png"
              /></a>
              </div>
          </div>
          <div class="pull-right">
            <h4>
              Powered by <a href="http://blog.getpelican.com/">Pelican</a>.
              Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.
              Title picture by
              <a
                href="https://pixabay.com/en/brandenburg-gate-berlin-landmark-2010656/"
                >Couleur via Pixabay</a
              >.
            </h4>
          </div>
        </div>
      </div>
    </footer>

    <!-- KaTeX rendering -->
    <script>
      renderMathInElement(document.body);
    </script>

 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66946155-1', 'auto');
  ga('send', 'pageview');

</script>    </body>
</html>